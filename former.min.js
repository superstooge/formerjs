var Former=function(a,b){if(this.parentEl=b||document.body,this.formObj={},"object"==typeof a)this.init(a);else if("string"==typeof a)try{this.init(JSON.parse(a))}catch(b){this.loadData(a)}};Former.prototype.loadData=function(a){var b=new XMLHttpRequest;b._this=this,b.open("GET",a,!0),b.onreadystatechange=function(){4==b.readyState&&"200"==b.status&&this._this.init(JSON.parse(b.responseText))},b.send(null)},Former.prototype.init=function(a){this.struc=a[0].fields,this.formAttributes=a[0],this.render()},Former.prototype.buildFormObj=function(){for(var a in this.formAttributes)"fields"!==a&&this.formAttributes.hasOwnProperty(a)&&(this.formObj[a]=this.formAttributes[a]);this.namespace=window[this.formObj.namespace]||window},Former.prototype.render=function(){this.buildFormObj();for(var a,b=0;b<this.struc.length;b++){a=this.parentEl;var c;switch(this.struc[b].type){case"select":c=document.createElement("select");for(var d=0;d<this.struc[b]["fjs-options"].length;d++){var e=document.createElement("option");e.data=this.struc[b]["fjs-options"][d].data,e.text=this.struc[b]["fjs-options"][d].text,this.struc[b]["fjs-options"][d].hasOwnProperty("selected")&&this.struc[b]["fjs-options"][d].selected===!0&&e.setAttribute("selected","selected"),c.appendChild(e)}break;case"textarea":c=document.createElement("textarea");break;case"label":c=document.createElement("label");break;default:c=document.createElement("input")}var f=this.struc[b];for(var g in f)f.hasOwnProperty(g)&&"fjs-"!==g.substr(0,4)&&c.setAttribute(g,f[g]);if("submit"===f.type&&c.addEventListener("click",this.validate.bind(this)),void 0!==f["fjs-content"]&&(c.innerHTML=f["fjs-content"]),void 0!==f["fjs-parent"]&&(a=document.getElementById(f["fjs-parent"]),!a))return void console.error("Could not find element with ID",f["fjs-parent"]);"LABEL"===a.nodeName?a.insertBefore(c,a.firstChild):a.appendChild(c)}},Former.prototype.validate=function(a){a.preventDefault(),a.stopPropagation();for(var b=!0,c=0;c<this.struc.length;c++){var d=this.struc[c],e=document.getElementById(this.struc[c].id);if("submit"!==this.struc[c].type.toLowerCase()&&"label"!==this.struc[c].type.toLowerCase()&&!e.hasAttribute("disabled")){if(d.hasOwnProperty("required")&&(""===e.value||e.options&&0===e.selectedIndex))return b=!1,d.hasOwnProperty("fjs-emptyFieldCallBack")&&this.namespace[d["fjs-emptyFieldCallBack"]](e),void e.focus();if(d.hasOwnProperty("fjs-validate")&&""!==d["fjs-validate"]){try{b=this.namespace[d["fjs-validate"]](e)}catch(a){console.error("Error: function",this.namespace+"."+d["fjs-validate"],"is not defined")}if(!b)return}}}b&&this.submit()},Former.prototype.harvest=function(){for(var a="",b=[],c=0;c<this.struc.length;c++)if("submit"!==this.struc[c].type.toLowerCase()&&"label"!==this.struc[c].type.toLowerCase()){var d=document.getElementById(this.struc[c].id);if(!d.hasAttribute("disabled")){var e=d.value;"checkbox"!==this.struc[c].type&&"radio"!==this.struc[c].type||(e=d.checked),b.push(encodeURIComponent(this.struc[c]["fjs-fieldName"]||this.struc[c].id)+"="+encodeURIComponent(e))}}return a=b.join("&").replace(/%20/g,"+")},Former.prototype.submit=function(){var a=this.harvest(),b=new XMLHttpRequest;b._this=this,b.onreadystatechange=function(){4==b.readyState&&200==b.status?(console.log(b.responseText),void 0!==this._this.formObj.submitSuccessCallBack&&this._this.namespace[this._this.formObj.submitSuccessCallBack]()):4==b.readyState&&b.status>=400&&void 0!==this._this.formObj.submitErrorCallBack&&this._this.namespace[this._this.formObj.submitErrorCallBack]()},b.open(this.formObj.method,this.formObj.action),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(a)};
