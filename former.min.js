var Former=function(a,b){if(this.parentEl=b||document.body,this.formObj={},"object"==typeof a)this.init(a);else if("string"==typeof a)try{this.init(JSON.parse(a))}catch(b){this.loadData(a)}};Former.prototype.loadData=function(a){var b=new XMLHttpRequest;b._this=this,b.open("GET",a,!0),b.onreadystatechange=function(){4==b.readyState&&"200"==b.status&&this._this.init(JSON.parse(b.responseText))},b.send(null)},Former.prototype.init=function(a){this.struc=a[0].fields,this.formAttributes=a[0],this.render()},Former.prototype.buildFormObj=function(){for(var a in this.formAttributes)"fields"!==a&&this.formAttributes.hasOwnProperty(a)&&(this.formObj[a]=this.formAttributes[a]);this.namespace=window[this.formObj.namespace]||window},Former.prototype.render=function(){this.buildFormObj();for(var a,b=0;b<this.struc.length;b++){a=this.parentEl;var c;if("select"===this.struc[b].type){c=document.createElement("select");for(var d=0;d<this.struc[b]["fjs-options"].length;d++){var e=document.createElement("option");e.data=this.struc[b]["fjs-options"][d].data,e.text=this.struc[b]["fjs-options"][d].text,c.appendChild(e)}}else c=document.createElement("input");var f=this.struc[b];for(var g in f)f.hasOwnProperty(g)&&"fjs-"!==g.substr(0,4)&&c.setAttribute(g,f[g]);if("submit"===f.type&&c.addEventListener("click",this.validate.bind(this)),void 0!==f["fjs-parent"]&&(a=document.getElementById(f["fjs-parent"]),!a))return void console.error("Could not find element with ID",f["fjs-parent"]);if(a.appendChild(c),f.hasOwnProperty("label")){var h=document.createElement("label");h.innerHTML=f.label,h.setAttribute("for",f.id),a.appendChild(h),h.insertBefore(c,h.firstChild),h.setAttribute("class",c.getAttribute("class")),c.setAttribute("class","")}}},Former.prototype.validate=function(){for(var a=!0,b=0;b<this.struc.length;b++){var c=this.struc[b],d=document.getElementById(this.struc[b].id);if(c.hasOwnProperty("required")&&""===d.value&&(a=!1,c.hasOwnProperty("emptyFieldMessage")&&alert(c.emptyFieldMessage),d.focus()),c.hasOwnProperty("fjs-validate")){try{a=this.namespace[c["fjs-validate"]](d)}catch(a){console.error("Error: function",this.namespace+"."+c["fjs-validate"],"is not defined")}if(!a)return}}a&&this.submit()},Former.prototype.harvest=function(){for(var a="",b=[],c=0;c<this.struc.length;c++)if("submit"!==this.struc[c].type){var d=document.getElementById(this.struc[c].id),e=d.value;"checkbox"!==this.struc[c].type&&"radio"!==this.struc[c].type||(e=d.checked),b.push(encodeURIComponent(this.struc[c]["fjs-fieldName"]||this.struc[c].id)+"="+encodeURIComponent(e))}return a=b.join("&").replace(/%20/g,"+")},Former.prototype.submit=function(){var a=this.harvest(),b=new XMLHttpRequest;b._this=this,b.onreadystatechange=function(){4==b.readyState&&200==b.status?(console.log(b.responseText),void 0!==this._this.formObj.submitSuccessCallBack&&this._this.namespace[this._this.formObj.submitSuccessCallBack]()):4==b.readyState&&b.status>=400&&void 0!==this._this.formObj.submitErrorCallBack&&this._this.namespace[this._this.formObj.submitErrorCallBack]()},b.open(this.formObj.method,this.formObj.action),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(a)};
